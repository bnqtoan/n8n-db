{
  "name": "Telegram to Google Sheets via AI Parsing",
  "nodes": [
    {
      "parameters": {},
      "name": "Start",
      "type": "n8n-nodes-base.start",
      "typeVersion": 1,
      "position": [
        250,
        300
      ]
    },
    {
      "parameters": {
        "authentication": "telegramApi",
        "chatId": "", // Điền Chat ID của bạn hoặc để trống để nhận từ tất cả các cuộc trò chuyện bot tham gia
        "updates": [
          "message"
        ],
        "otherOptions": {}
      },
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        450,
        300
      ],
      "credentials": {
        "telegramApi": { // Thay thế bằng tên credential Telegram của bạn
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram Bot Account"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-3.5-turbo", // Hoặc model bạn muốn sử dụng, ví dụ: gpt-4
        "prompt": "=Trích xuất các thông tin sau từ văn bản được cung cấp:\n1. Số tài khoản người nhận (luôn là một dãy số)\n2. Tên người nhận (tên riêng hoặc tên công ty)\n3. Tên ngân hàng nhận (ví dụ: Vietcombank, Techcombank, BIDV, MBBank, ACB, Sacombank, VPBank, Agribank, TPBank, v.v.)\n4. Số tiền chuyển khoản (chỉ lấy phần số, ví dụ 100000)\n5. Đơn vị tiền tệ (ví dụ VND, USD. Nếu không rõ, mặc định là VND)\n6. Nội dung chuyển khoản (phần còn lại của tin nhắn không thuộc các mục trên)\n\nVăn bản:\n{{ $json.message.text }}\n\nTrả về kết quả dưới dạng một đối tượng JSON duy nhất với các key sau (không bao gồm số thứ tự đầu dòng, không giải thích, chỉ trả JSON): `accountNumber`, `recipientName`, `bankName`, `amount`, `currency`, `transactionContent`. Nếu không tìm thấy thông tin nào, hãy để giá trị là một chuỗi rỗng \"\". `amount` phải là một số.",
        "options": {
          "responseFormat": "json_object"
        }
      },
      "name": "AI Parse Transaction",
      "type": "n8n-nodes-ai-agents.openAi",
      "typeVersion": 1,
      "position": [
        650,
        300
      ],
      "credentials": {
        "openAiApi": { // Thay thế bằng tên credential OpenAI của bạn
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAI Account"
        }
      }
    },
    {
      "parameters": {
        "documentId": { // Điền Spreadsheet ID của bạn
          "__rl": true,
          "value": "YOUR_SPREADSHEET_ID",
          "mode": "url",
          "url": "https://docs.google.com/spreadsheets/d/YOUR_SPREADSHEET_ID/edit"
        },
        "sheetName": { // Điền tên Sheet của bạn, ví dụ: "Giao Dich Telegram"
          "__rl": true,
          "value": "Giao Dich Telegram",
          "mode": "list",
          "sheetId": "YOUR_SHEET_NAME_OR_ID"
        },
        "operation": "append",
        "columns": {
          "mappingMode": "manual",
          "value": [
            {
              "columnName": "Timestamp",
              "columnValue": "={{ new Date().toISOString() }}"
            },
            {
              "columnName": "Telegram Message ID",
              "columnValue": "={{ $json.message.message_id }}"
            },
            {
              "columnName": "Raw Message Content",
              "columnValue": "={{ $json.message.text }}"
            },
            {
              "columnName": "Account Number",
              "columnValue": "={{ $('AI Parse Transaction').json.choices[0].message.content.accountNumber }}"
            },
            {
              "columnName": "Recipient Name",
              "columnValue": "={{ $('AI Parse Transaction').json.choices[0].message.content.recipientName }}"
            },
            {
              "columnName": "Bank Name",
              "columnValue": "={{ $('AI Parse Transaction').json.choices[0].message.content.bankName }}"
            },
            {
              "columnName": "Amount",
              "columnValue": "={{ parseFloat($('AI Parse Transaction').json.choices[0].message.content.amount) }}"
            },
            {
              "columnName": "Currency",
              "columnValue": "={{ $('AI Parse Transaction').json.choices[0].message.content.currency }}"
            },
            {
              "columnName": "Transaction Content",
              "columnValue": "={{ $('AI Parse Transaction').json.choices[0].message.content.transactionContent }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Google Sheets Append",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.2,
      "position": [
        850,
        300
      ],
      "credentials": {
        "googleSheetsOAuth2Api": { // Thay thế bằng tên credential Google Sheets của bạn
          "id": "YOUR_GOOGLE_SHEETS_CREDENTIAL_ID",
          "name": "Google Sheets Account"
        }
      }
    }
  ],
  "connections": {
    "Start": {
      "main": [
        [
          {
            "node": "Telegram Trigger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "AI Parse Transaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Parse Transaction": {
      "main": [
        [
          {
            "node": "Google Sheets Append",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "V1"
  },
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "YOUR_INSTANCE_ID_FOR_IDENTIFICATION"
  }
}
